@{
    Layout = "~/Areas/Admin/Views/Shared/Layout/_LayoutAdmin.cshtml";
}
@using Hrmanagement.Core.DTO.DtoOutput;
@{
    var leaveData = ViewData["leaveUserData"] as List<LeaveOutput>;
}
<style>
    .center {
        margin: auto;
        width: 44%;
        padding: 20px;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    }

    .textarea {
        width: 100%;
    }

    .hideform {
        display: none;
    }
</style>

<section class="content">
    @* <div class="modal fade" id="rejectModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
    <div class="modal-header">
    <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
    <span aria-hidden="true">&times;</span>
    </button>
    </div>
    <div class="modal-body">
    <textarea class="textarea" id="rejectRemark" name="Remark" rows="4" cols="50" required>
    </textarea>
    </div>
    <div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-dismiss="modal" id="modalCloseBtn">Close</button>
    <button type="button" class="btn btn-primary" id="modalSubmitBtn">Save changes</button>
    </div>
    </div>
    </div>
    </div>*@
    <div class="row">
        <div class="col-xs-12">
            <div class="box">
                <div class="box-header">
                    <h3 class="box-title">Leave List</h3>
                </div>
                <div class="box-body">
                    <div class="table-responsive">
                    <table id="example1" class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>Id</th>
                                @*<th>User Name</th>*@
                                <th>From Date</th>
                                <th>To Date</th>
                               @* <th>CreatedAt</th>*@
                                <th>Total Days</th>
                                <th>Status</th>
                                <th>View</th>
                                
                            </tr>
                        </thead>
                        <tbody>
                            @if (leaveData != null)
                            {

                                var i = 0;


                                @foreach (var leave in leaveData)
                                {
                                    <tr>
                                        <td>
                                            @(
                                                ++i
                                                )
                                        </td>
                                        @*<td>@leave.UserName</td>*@
                                        <td>@leave.LeaveFromDate</td>
                                        <td>@leave.LeaveToDate</td>
                                        @*<td>@leave.CreatedAt</td>*@
                                        <td>@leave.TotalLeaveDays</td>
                                        <td>
                                            @if (leave.IsLeaveApproved == true)
                                            {

                                                <h4 style="background-color:green;width:50%;height:26px;color:white;">Approved</h4>
                                            }
                                            else if (leave.IsRejected == true)
                                            {

                                                <h4 style="background-color:red;width:50%;height:26px;color:white;">Rejected</h4>
                                            }
                                            else
                                            {

                                                <h4 style="background-color:yellow;width:50%;height:26px;color:blue;">Pending</h4>
                                            }

                                        </td>
                                        <td>
                                            <a class="dropdown-item" href="~/Admin/Leave/leaveById/@leave.Id">View</a><br>
                                        </td>


                                    </tr>
                                }
                            }
                    </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<script>

    async function updateLeaveStatus(Id, value) {
        console.log(Id);
        let isApproved = false;
        let isRejected = false;
        let remark = "Null";
        if (value == "approve")
            isApproved = true;
        else {
            var res = await openPopupBox();
            if (!res)
                return;
            else {
                remark = document.getElementById('rejectRemark').value;
                isRejected = true;
            }
        }
        let payload = {
            IsApproved: isApproved,
            IsRejected: isRejected,
            Remark: remark,
            Id: Id
        }
        submitLeaveStatusForm(payload);
    }

    function openPopupBox(value) {
        return new Promise((resolve, reject) => {
            $('#rejectModal').modal('show');
            document.getElementById('modalCloseBtn').addEventListener("click", function () {
                $('#rejectModal').modal('hide');
                reject(false);
            });
            document.getElementById('modalSubmitBtn').addEventListener("click", function () {
                $('#rejectModal').modal('hide');
                resolve(true);
            });
        });
    }

    function submitLeaveStatusForm(payload) {
        console.log(payload);
        var queryString = $.param(payload);
        $.ajax(
            {
                //url: "/../Admin/Leave/updateLeavestatus/Id",
                url: "/Admin/Leave/updateLeavestatus?" + queryString,
                type: "post",
                // data: payload,
                success: function (response) {
                    console.log(response);
                },
            }
        );
    }

</script>
